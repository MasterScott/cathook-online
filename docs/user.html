<html>
    <head>
        <title>cathook</title>
        <script src="js/basic.js"></script>
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <h1>User profile</h1>
        <table>
            <tr>
                <td>Username</td>
                <td id="username"></td>
            </tr>
            <tr>
                <td>Joined at</td>
                <td id="registered"></td>
            </tr>
            <tr>
                <td>Software</td>
                <td id="software"></td>
            </tr>
            <tr>
                <td>Custom color</td>
                <td id="color"></td>
            </tr>
        </table>

        <!-- Change software -->
        <div class="hidden show-own">
            <span>Change software: </span>
            <select id="software-select"></select>
            <input id="software-change" type="button" value="Change">
        </div>
        <!-- Change color -->
        <div class="hidden show-own">
            <span>Change color: </span>
            <input id="color-input" type="text" placeholder="ff0000" maxlength="6">
            <input id="color-change" type="button" value="Change">
            <span id="color-preview">E</span>
        </div>

        <div class="hidden show-own">
            <p>To use cathook online features, you will need your API key. After you launch cathook, type "cat_online_login &lt;KEY&gt;" in console.</p>
            <input id="show-api-key" value="Show your API key" type="button">
            <p id="revealed-api-key"></p>
        </div>

        <div>
            <div class="hidden show-admin">
                <select id="group-select"></select>
                <input id="group-add" value="Add to group" type="button">
            </div>
            <p>Groups:</p>
            <ul id="groups"></ul>
        </div>

        <div class="hidden show-own">
            <p>Invites:</p>
            <input type="button" id="generate" value="Generate invite">
            <ul id="invites"></ul>
        </div>

        <div class="hidden show-own">
            <p>Associated Steam accounts: <span id="steam-account-count"></span></p>
            <table id="steam-account-table">
            </table>
            <a href="#" id="navigate-steam-back">&lt;</a>
            <input type="text" id="navigate-steam-input">
            <a href="#" id="navigate-steam-forward">&gt;</a>
        </div>

        <p id="status"></p>
        <script>
const query = new URLSearchParams(window.location.search);

console.log(query.get('name'));

const list = document.getElementById('invites');
async function refreshInviteList()
{
    try {
        const invites = await request.get('/invite');
        const data = JSON.parse(invites.responseText);
        list.innerHTML = '';
        for (i of data)
        {
            const li = document.createElement('li');
            li.appendChild(document.createTextNode(i.key));
            list.appendChild(li);
        }
    } catch (e) {
        document.getElementById('status').innerHTML = `Error: ${e.status} - ${e.responseText}`;
    }
}

document.getElementById('generate').addEventListener('click', async () => {
    try {
        const xhr = await request.post(`${host}/invite?key=${localStorage.api_key}`);
        const li = document.createElement('li');
        li.appendChild(document.createTextNode(xhr.responseText));
        list.appendChild(li);
    } catch (e) {
        document.getElementById('status').innerHTML = `Error: ${e.status} - ${e.responseText}`;
    }
});

fillSoftwareSelect(document.getElementById('software-select'));
fillGroupSelect(document.getElementById('group-select'));

refreshInviteList();
        </script>
    </body>
</html>
